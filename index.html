<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <title>TodoList DOM</title>
  </head>
  <body>
    <div class="container-md border mt-3 todo-container">
      <p class="bg-info display-5">TodoList with pure DOM</p>
      <div class="input-group input-group-lg mb-3">
        <input type="text" class="form-control" id="newjob" />
        <button
          class="btn btn-outline-secondary"
          type="button"
          onclick="addJob()"
        >
          Add
        </button>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <script>

    let list = [
        { id: 1, jobName: "Practice HTML", status: "undone" },
        { id: 2, jobName: "Practice CSS", status: "undone" },
        { id: 3, jobName: "Practice Javascript", status: "undone" },
        { id: 4, jobName: "Practice Git", status: "undone" },
    ];  

      function renderJob(item) {
        let target = document.body.firstElementChild
        let divInputGroup = document.createElement("div");
        divInputGroup.classList.add("input-group", "my-2");
          let divGroupText = document.createElement('div')
          divGroupText.classList.add('input-group-text')
            let inputCheckbox = document.createElement('input')
            inputCheckbox.classList.add('form-check-input', 'mt-0')
            inputCheckbox.setAttribute('type','checkbox')
          let inputText = document.createElement("input");
          inputText.classList.add("form-control");
          inputText.setAttribute("type", "text");
          inputText.setAttribute("readonly", "");
          inputText.value = item.jobName

          let btnEdit = document.createElement("button");
          btnEdit.classList.add("btn", "btn-outline-secondary");
          btnEdit.innerText = "Edit";
          btnEdit.setAttribute("type", "button");
          btnEdit.addEventListener("click", () => editJob(item.id));

          let btnDel = document.createElement("button");
          btnDel.classList.add("btn", "btn-outline-secondary");
          btnDel.innerText = "Delete";
          btnDel.setAttribute("type", "button");
          btnDel.addEventListener("click", () => deleteJob(item.id));
      
        divGroupText.appendChild(inputCheckbox)
        divInputGroup.appendChild(divGroupText)
        divInputGroup.appendChild(inputText)
        divInputGroup.appendChild(btnEdit)
        divInputGroup.appendChild(btnDel)  

        target.appendChild(divInputGroup)
      }

      function addJob() {
        let newJobText = document.querySelector("#newjob").value;
        if (newJobText === null || newJobText.trim() === "") return;    // let student try
        let newJob = {
          id: list.length > 0 ? list[list.length - 1].id + 1 : 1,     
          jobName: newJobText,
          status: "undone"
        }
        list.push(newJob);
        // renderJob(newJob)
        render();
        document.querySelector("#newjob").value = "";
        document.querySelector("#newjob").select();
      }

      function deleteJob(del_id) {
        console.log(del_id);
        list = [...list.filter((x) => x.id !== del_id)];
        render();
      }

      function editJob(e_id) {
        // event.preventDefault();
        let ele = event.target;
        let editBox = ele.previousElementSibling;
        console.log(ele);
        if (editBox.readOnly) {
          ele.innerText = "OK";
          ele.classList.add("bg-info");
          editBox.readOnly = false;
          editBox.select();
        } else {
          ele.innerText = "Edit";
          ele.classList.remove("bg-info");
          editBox.readOnly = true;
          newJobName = editBox.value;
          let idx = list.findIndex((x) => x.id === e_id);
          list[idx].jobName = newJobName;
          render();
        }
      }

      function clearElement() {
        let target= document.querySelector('.todo-container')
        while (target.children[2]) {
          target.removeChild(target.children[2]);
        }
      }

      function render() {
        clearElement()
        list.forEach(x => {
          renderJob(x)
      })
      }

      render()
 
    </script>
  </body>
</html>
